name: Node coverage report
description: This action updates or adds SVG badge to your wiki.
branding:
  color: blue
  icon: award

inputs:
  command:
    description: A test command that should be able to output test coverage.
    default: npm run test:coverage
  coverage-dir:
    description: Test coverage file output directory.
    default: coverage
  output-dir:
    description: Custom output directory for the badge. By default, the wiki's root directory.
  badge-style:
    description: Badge style generated by shields.io (one of flat, flat-square, plastic, for-the-badge, social).
    default: flat
  badge-title:
    description: Badge title generated by shields.io.
    default: coverage
  amend:
    description: Amend wiki, avoiding spurious commits.
    default: false

runs:
  using: composite
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
      if: |
        hashFiles('.github') == ''      

    - name: Checkout wiki
      uses: actions/checkout@v4
      with:
        repository: ${{github.repository}}.wiki
        path: ./.github/wiki/

    - name: Generate coverage report
      shell: bash
      env:
        INPUT_COMMAND: ${{inputs.command}}
        INPUT_COVERAGE_DIR: ${{inputs.coverage-dir}}
        INPUT_BADGE_STYLE: ${{inputs.badge-style}}
        INPUT_BADGE_TITLE: ${{inputs.badge-title}}
      run: |
        ${{github.action_path}}/coverage.sh ./.github/wiki/${{inputs.output-dir}}

    - name: Push to wiki
      shell: bash
      env:
        INPUT_AMEND: ${{inputs.amend}}
      run: |
        ${{github.action_path}}/push.sh ./.github/wiki/
